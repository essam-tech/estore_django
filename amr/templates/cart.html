{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <h2>🛒 سلة التسوق</h2>

  {% if items %}
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>المنتج</th>
        <th>السعر</th>
        <th>الكمية</th>
        <th>الإجمالي</th>
      </tr>
    </thead>
    <tbody>
      {% for item in items %}
      <tr>
        <td>{{ item.product.name }}</td>
        <td>{{ item.product.price }} ر.س</td>
        <td>
          <form method="post" action="{% url 'update_cart_item' item.id %}">
            {% csrf_token %}
            <input type="number" name="quantity" value="{{ item.quantity }}" min="0" class="form-control" style="width:80px; display:inline-block;">
            <button type="submit" class="btn btn-sm btn-primary">تحديث</button>
          </form>
        </td>
        <td>{{ item.product.price|floatformat:2|add:""|floatformat:2|floatformat:2 }} × {{ item.quantity }} = {{ item.product.price|floatformat:2|add:""|floatformat:2|floatformat:2 }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <h4>الإجمالي: {{ subtotal }} ر.ي</h4>

  <form method="post" action="{% url 'checkout' %}">
    {% csrf_token %}
    <button type="submit" class="btn btn-success">إتمام الشراء</button>
  </form>
  {% else %}
  <p>السلة فارغة حالياً.</p>
  {% endif %}
</div>
{% endblock %}
